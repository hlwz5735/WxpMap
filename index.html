<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>地图Demo1</title>
    <link rel="stylesheet" href="css/map.css" />
    <style>
        .body-container {
            /*width: 1000px;*/
            /*height: 800px;*/
            /*margin-top: 100px;*/
            margin-left: auto;
            margin-right: auto;
            border: 1px solid black;
            background: #949297;
        }
    </style>
</head>
<body>

<div class="body-container">
    <div class="wxp-map">
        <div class="map-container">
            <div class="map-image"></div>
        </div>
    </div>
</div>

<script src="js/jquery.min.js"></script>
<script type="text/javascript">
    $(function () {
        var mapWidth = 1210, mapHeight = 700;
        var containerWidth = $(".wxp-map").width(), containerHeight = mapHeight;
        var mapImageUrl = "image/map_china1.jpg";

        if ($(window).height() - 140 < mapHeight) containerHeight = $(window).height() - 140;

        $(".map-container").css({'width':containerWidth+'px','height':containerHeight+'px'});
        $(".map-image").css({'width':mapWidth+'px','height':mapHeight+'px'});

        var itemArr = [
            {x: 777, y: 256, name: '北京'},
            {x: 363, y: 172, name: '乌鲁木齐'},
            {x: 797, y: 325, name: '济南'},
            {x: 923, y: 141, name: '哈尔滨'},
            {x: 882, y: 228, name: '沈阳'},
            {x: 707, y: 243, name: '呼和浩特'},
            {x: 723, y: 305, name: '太原'},
            {x: 742, y: 365, name: '郑州'},
            {x: 666, y: 369, name: '西安'},
            {x: 869, y: 423, name: '上海'},
            {x: 587, y: 340, name: '兰州'},
            {x: 555, y: 327, name: '青藏公司'},
            {x: 575, y: 442, name: '成都'},
            {x: 792, y: 476, name: '南昌'},
            {x: 754, y: 438, name: '武汉'},
            {x: 550, y: 549, name: '昆明'},
            {x: 656, y: 590, name: '南宁'},
            {x: 744, y: 582, name: '广州'}];

        for (var i = 0; i < itemArr.length; i++) {

            var elem = $('<div class="map-mark-container"' +
                "data-title='"+ itemArr[i].name +"' data-content='" + "content!" + "' data-trigger='hover' " +
                "data-placement='top'" +
                '><div class="map-mark-text">' +
                itemArr[i].name + '<img src="css/image/redPin.gif"/>' +
                '</div></div>');

            elem.css({
                'top':itemArr[i].y,
                'left':itemArr[i].x - 12 * itemArr[i].name.length
            });

            $(".map-image").append(elem);
        }

        var offset = $('.map-image').offset();

        var initX = 0;
        var initY = 0;
        var isMove = false;
        $(".map-container").mousedown(function (event) {
            //offset 为现在的偏移量
            offset = $('.map-image').position();

            initX = event.pageX;
            initY = event.pageY;

            isMove = true;

            $(document).mousemove(function (event) {
                    if (isMove) {
                        var absX = offset.left - initX + event.pageX;
                        if (absX > 0) absX = 0;
                        else if (absX < containerWidth - mapWidth) {
                            if (mapWidth < containerWidth) absX = 0;
                            else absX = containerWidth - mapWidth;
                        }

                        var absY = offset.top - initY + event.pageY;
                        if (absY > 0) absY = 0;
                        else if (absY < containerHeight - mapHeight) {
                            if (mapHeight < containerHeight) absY = 0;
                            else absY = containerHeight - mapHeight;
                        }

                        $('.map-image').css({'left': absX, 'top': absY});
                    }
                }
            ).mouseup(
                function () {
                    isMove = false;
                }
            );
        });
        $('.map-image').css({'background-image': 'url("'+ mapImageUrl +'")'});
        if ($.webuiPopover) $(".map-mark-container").webuiPopover();
        var mapContainer = $(".map-container").get(0);
        mapContainer.onselectstart = mapContainer.ondrag = function() {
            return false;
        }

    });
</script>
</body>
</html>